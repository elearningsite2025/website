<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elearning ƒë∆°n gi·∫£n</title>
    <!-- T·∫£i Tailwind CSS t·ª´ CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* ƒê·∫£m b·∫£o iframe ph·∫£n h·ªìi t·ªët tr√™n mobile */
        .responsive-iframe-container {
            position: relative;
            overflow: hidden;
            /* Gi·ªØ chi·ªÅu cao c·ªë ƒë·ªãnh ƒë·ªÉ Form hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß tr√™n m·ªçi thi·∫øt b·ªã */
            height: 675px; 
        }
        .responsive-iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        /* CSS cho hi·ªáu ·ª©ng th√¥ng b√°o ch·∫∑n tua */
        .seek-block-message {
            opacity: 0;
            pointer-events: none;
        }
        .seek-block-message.visible {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center p-4">

    <!-- Container ch√≠nh -->
    <div class="w-full max-w-4xl bg-white p-6 md:p-10 rounded-xl shadow-2xl mt-8">

        <!-- PH·∫¶N 1: BANNER ƒê∆†N V·ªä T·ªî CH·ª®C (N·ªôi dung ƒë∆∞·ª£c ch√®n b·∫±ng JavaScript) -->
        <div class="bg-blue-800 text-white p-4 rounded-t-xl flex flex-col items-center justify-center">
            <p id="banner-line-1" class="font-bold text-lg leading-tight"></p>
            <p id="banner-line-2" class="font-medium text-base leading-tight"></p>
        </div>

        <!-- PH·∫¶N 2: T√äN B√ÄI H·ªåC (N·ªôi dung ƒë∆∞·ª£c ch√®n b·∫±ng JavaScript) -->
        <h1 id="lesson-title" class="text-3xl font-extrabold text-indigo-700 mb-8 text-center border-b pb-4 pt-4">
        </h1>

        <!-- Khu v·ª±c nh√∫ng Video YouTube (Th√™m relative cho overlay) -->
        <div class="relative aspect-video w-full rounded-lg overflow-hidden shadow-xl mb-4">
            
            <!-- TH√îNG B√ÅO CH·∫∂N TUA (M·ªöI) -->
            <div id="seek-block-message" class="seek-block-message absolute inset-0 bg-red-600/90 text-white flex items-center justify-center text-xl font-bold p-4 transition-opacity duration-300 z-10 rounded-lg">
                üö´ Ch·ª©c nƒÉng tua video ƒë√£ b·ªã v√¥ hi·ªáu h√≥a. Vui l√≤ng xem ti·∫øp.
            </div>
            
            <!-- URL src s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p b·∫±ng JavaScript t·ª´ CONFIG.VIDEO_ID -->
            <iframe
                id="youtube-video"
                src="" 
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
                class="w-full h-full"
                title="Video B√†i Gi·∫£ng"
            ></iframe>
        </div>
        
        <!-- D√≤ng th√¥ng b√°o quan tr·ªçng v·ªÅ b√†i ki·ªÉm tra (M·ªöI) -->
        <p class="text-center text-lg font-semibold text-red-600 bg-red-100 p-3 rounded-lg border border-red-300 mb-10 shadow-md">
            ‚ö†Ô∏è Th√¥ng b√°o quan tr·ªçng: c√°c Anh Ch·ªã vui l√≤ng xem h·∫øt video b√†i h·ªçc ƒë·ªÉ c√≥ th·ªÉ th·∫•y ph·∫ßn b√†i ki·ªÉm tra.
        </p>

        <!-- KHU V·ª∞C CH·ª®A FORM (·∫®N BAN ƒê·∫¶U) -->
        <div id="quiz-container" style="display: none;">
            
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
                ‚úÖ B√†i Tr·∫Øc Nghi·ªám (ƒê√£ Ho√†n Th√†nh Video)
            </h2>

            <!-- KHU V·ª∞C NH√öNG GOOGLE FORM -->
            <div class="responsive-iframe-container rounded-xl shadow-lg">
                <!-- URL src s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p b·∫±ng JavaScript t·ª´ CONFIG.QUIZ_URL -->
                <iframe 
                    id="quiz-iframe"
                    src="" 
                    width="100%" 
                    height="675" 
                    frameborder="0" 
                    marginheight="0" 
                    marginwidth="0"
                    title="Google Form Quiz">
                    Loading‚Ä¶
                </iframe>
            </div>
            <!-- END KHU V·ª∞C NH√öNG GOOGLE FORM -->

            <p class="mt-8 text-center text-sm text-gray-500">
                Vui l√≤ng ƒëi·ªÅn v√† nh·∫•n G·ª≠i trong Form n√†y ƒë·ªÉ ho√†n t·∫•t b√†i ki·ªÉm tra.
            </p>
        </div>
    </div>

    <!-- PH·∫¶N 3: FOOTER -->
    <footer class="w-full max-w-4xl mt-8 p-4 bg-gray-200 text-gray-700 text-center rounded-xl shadow-inner text-sm md:text-base">
        <p class="font-semibold mb-1">Li√™n h·ªá h·ªó tr·ª£:</p>
        <p>
            Mr. <span id="contact-name"></span> - 
            <a id="contact-phone-link" href="#" class="text-indigo-600 hover:text-indigo-800 transition duration-150 ease-in-out font-medium"></a> - 
            <a id="contact-email-link" href="#" class="text-indigo-600 hover:text-indigo-800 transition duration-150 ease-in-out font-medium"></a>
        </p>
    </footer>


    <!-- Script t·∫£i API YouTube v√† Logic Gi√°m S√°t/·∫®n Hi·ªán Form -->
    <script>
        // =====================================================================
        // [KH·ªêI C·∫§U H√åNH T·∫¨P TRUNG] - D·ªÖ d√†ng c·∫≠p nh·∫≠t c√°c th√¥ng tin b√†i h·ªçc t·∫°i ƒë√¢y
        // =====================================================================
        const CONFIG = {
            // 1. D√≤ng ch·ªØ l·ªõn tr√™n banner
            BANNER_LINE_1: "C√¥ng ty L∆∞·ªõi ƒëi·ªán Cao th·∫ø TPHCM",
            // 2. D√≤ng ch·ªØ nh·ªè tr√™n banner
            BANNER_LINE_2: "ƒê·ªôi Qu·∫£n l√Ω ƒê∆∞·ªùng d√¢y",
            // 3. Ti√™u ƒë·ªÅ ch√≠nh c·ªßa b√†i h·ªçc
            LESSON_TITLE: "B√†i s·ªë 1: ƒê√†o t·∫°o n√¢ng cao nh·∫≠n th·ª©c an to√†n th√¥ng tin trong EVNHCMC nƒÉm 2025",
            // 4. ID video YouTube (V√≠ d·ª•: "4AKjAPLb4nw")
            VIDEO_ID: "XSD4Bu9jt20", 
            // 5. URL Google Form b√†i ki·ªÉm tra
            QUIZ_URL: "https://docs.google.com/forms/d/e/1FAIpQLSfuGdLrMIKYDGEhpjjhwL7TnwUs02oufjsWfkEmxFd5kRb4kw/viewform?embedded=true",
            // 6. Cho ph√©p tua nhanh video (true: cho ph√©p tua, false: c·∫•m tua)
            ALLOW_SEEKING: false, // ƒê·ªïi th√†nh false ƒë·ªÉ test ch·ª©c nƒÉng ch·∫∑n tua
            // [M·ªöI] 7. C·∫•u h√¨nh Footer
            FOOTER_CONTACT: {
                NAME: "Tr·∫ßn C√¥ng ƒê·∫πp",
                PHONE: "0963.292.882",
                EMAIL: "elearningesite2025@gmail.com"
            }
        };
        // =====================================================================

        let player;
        let saveInterval;
        let blockMessageTimeout; // Bi·∫øn timeout cho th√¥ng b√°o ch·∫∑n tua
        const localStorageKey = 'video_resume_time_' + CONFIG.VIDEO_ID;
        const highestWatchedKey = 'video_highest_time_' + CONFIG.VIDEO_ID; 
        const seekBlockMessage = document.getElementById('seek-block-message');

        // H√†m √°p d·ª•ng CONFIG v√†o DOM tr∆∞·ªõc khi t·∫£i API YouTube
        function applyConfigToDOM() {
            // C·∫≠p nh·∫≠t Banner v√† Ti√™u ƒë·ªÅ
            document.getElementById('banner-line-1').textContent = CONFIG.BANNER_LINE_1;
            document.getElementById('banner-line-2').textContent = CONFIG.BANNER_LINE_2;
            document.getElementById('lesson-title').textContent = CONFIG.LESSON_TITLE;

            // C·∫≠p nh·∫≠t URL Video
            const videoIframe = document.getElementById('youtube-video');
            // Th√™m 'controls=0' v√†o URL ƒë·ªÉ ·∫©n thanh ƒëi·ªÅu khi·ªÉn c·ªßa YouTube, √©p bu·ªôc ng∆∞·ªùi d√πng t∆∞∆°ng t√°c trong iframe
            const videoUrl = `https://www.youtube.com/embed/${CONFIG.VIDEO_ID}?enablejsapi=1&version=3&playerapiid=ytplayer&rel=0&fs=0&controls=0&modestbranding=1&iv_load_policy=3`;
            videoIframe.src = videoUrl;

            // C·∫≠p nh·∫≠t URL Quiz Form
            document.getElementById('quiz-iframe').src = CONFIG.QUIZ_URL;

            // C·∫≠p nh·∫≠t Footer
            const contact = CONFIG.FOOTER_CONTACT;
            const phoneClean = contact.PHONE.replace(/[^\d]/g, ''); 
            
            document.getElementById('contact-name').textContent = contact.NAME;
            
            const phoneLink = document.getElementById('contact-phone-link');
            phoneLink.href = `tel:${phoneClean}`;
            phoneLink.textContent = contact.PHONE;

            const emailLink = document.getElementById('contact-email-link');
            emailLink.href = `mailto:${contact.EMAIL}`;
            emailLink.textContent = contact.EMAIL;
        }

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o ch·∫∑n tua (M·ªöI)
        function showSeekBlockMessage() {
            if (!seekBlockMessage) return;
            
            // X√≥a timeout c≈© n·∫øu c√≥
            clearTimeout(blockMessageTimeout);
            
            // Hi·ªÉn th·ªã th√¥ng b√°o
            seekBlockMessage.classList.add('visible');
            
            // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
            blockMessageTimeout = setTimeout(() => {
                seekBlockMessage.classList.remove('visible');
            }, 3000);
        }

        // G·ªçi h√†m applyConfigToDOM khi DOM ƒë√£ s·∫µn s√†ng
        window.addEventListener('DOMContentLoaded', applyConfigToDOM);

        // H√†m n√†y ƒë∆∞·ª£c g·ªçi t·ª± ƒë·ªông khi API YouTube ƒë√£ s·∫µn s√†ng
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-video', {
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // H√†m l∆∞u v·ªã tr√≠ hi·ªán t·∫°i v√† v·ªã tr√≠ cao nh·∫•t ƒë√£ xem
        function saveCurrentTimeAndHighest() {
            if (player && typeof player.getCurrentTime === 'function') {
                const currentTime = player.getCurrentTime();
                let highestTime = parseFloat(localStorage.getItem(highestWatchedKey) || '0');

                // C·∫≠p nh·∫≠t v·ªã tr√≠ cao nh·∫•t
                if (currentTime > highestTime) {
                    highestTime = currentTime;
                    localStorage.setItem(highestWatchedKey, Math.floor(highestTime));
                }
                
                // V·∫´n l∆∞u v·ªã tr√≠ hi·ªán t·∫°i ƒë·ªÉ resume
                localStorage.setItem(localStorageKey, Math.floor(currentTime));
            }
        }

        function onPlayerReady(event) {
            const savedTime = localStorage.getItem(localStorageKey);
            
            // T·∫£i l·∫°i v·ªã tr√≠ (ch·ª©c nƒÉng resume)
            if (savedTime && parseFloat(savedTime) > 0) {
                event.target.seekTo(parseFloat(savedTime), true);
                event.target.playVideo(); // T·ª± ƒë·ªông ph√°t ti·∫øp
            } else {
                event.target.playVideo(); // B·∫Øt ƒë·∫ßu ph√°t t·ª´ ƒë·∫ßu n·∫øu ch∆∞a xem
            }

            // Thi·∫øt l·∫≠p c∆° ch·∫ø l∆∞u t·ª± ƒë·ªông (m·ªói 1 gi√¢y)
            clearInterval(saveInterval); 
            saveInterval = setInterval(() => {
                const state = player.getPlayerState();
                // Ch·ªâ l∆∞u khi video ƒëang ph√°t
                if (state === YT.PlayerState.PLAYING) {
                    saveCurrentTimeAndHighest();
                    
                    // [KI·ªÇM TRA C·∫§M TUA]
                    if (!CONFIG.ALLOW_SEEKING) {
                        // Ki·ªÉm tra v√† ngƒÉn ng∆∞·ªùi d√πng tua l√πi
                        const currentTime = player.getCurrentTime();
                        const highestTime = parseFloat(localStorage.getItem(highestWatchedKey) || '0');

                        // N·∫øu ng∆∞·ªùi d√πng tua l√πi qu√° 2 gi√¢y so v·ªõi v·ªã tr√≠ cao nh·∫•t ƒë√£ xem, tua l·∫°i.
                        if (currentTime < highestTime - 2) {
                            player.seekTo(highestTime, true);
                            showSeekBlockMessage(); // HI·ªÇN TH·ªä TH√îNG B√ÅO (M·ªöI)
                            console.warn("Ch·∫∑n tua nhanh/tua l√πi: Tr·ªü l·∫°i v·ªã tr√≠ xem cao nh·∫•t.");
                        }
                    }
                }
            }, 1000); // Ki·ªÉm tra v√† l∆∞u m·ªói gi√¢y
        }

        // L∆∞u v·ªã tr√≠ cu·ªëi c√πng tr∆∞·ªõc khi ng∆∞·ªùi d√πng ƒë√≥ng/t·∫£i l·∫°i trang
        window.addEventListener('beforeunload', saveCurrentTimeAndHighest);

        // X·ª≠ l√Ω s·ª± ki·ªán thay ƒë·ªïi tr·∫°ng th√°i c·ªßa Player
        function onPlayerStateChange(event) {
            const quizContainer = document.getElementById('quiz-container');
            
            // Tr·∫°ng th√°i YT.PlayerState.ENDED (Video ƒë√£ k·∫øt th√∫c)
            if (event.data === YT.PlayerState.ENDED) {
                // X√≥a t·∫•t c·∫£ v·ªã tr√≠ ƒë√£ l∆∞u
                localStorage.removeItem(localStorageKey);
                localStorage.removeItem(highestWatchedKey);

                // Hi·ªÉn th·ªã Form Tr·∫Øc Nghi·ªám
                quizContainer.style.display = 'block';
                
                // Cu·ªôn xu·ªëng ƒë·ªÉ ng∆∞·ªùi d√πng th·∫•y Form ngay l·∫≠p t·ª©c
                quizContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else if (event.data === YT.PlayerState.PLAYING) {
                 // ƒê·∫£m b·∫£o Form lu√¥n ·∫©n khi video ƒëang ph√°t
                quizContainer.style.display = 'none';
            }
        }

        // T·∫£i script YouTube Iframe Player API
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    </script>
</body>
</html>

